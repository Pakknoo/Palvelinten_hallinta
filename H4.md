h4 Demoni

#### x) Lue ja tiivistä. 

(Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)
        Karvinen 2023: Salt Vagrant - automatically provision one master and two slaves, vain kohdat
            Infra as Code - Your wishes as a text file
            top.sls - What Slave Runs What States
        Salt contributors: Salt overview, kohdat
            Rules of YAML
            YAML simple structure
            Lists and dictionaries - YAML block structures
        Karvinen 2018: Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port
            Artikkelissa on jonkun toisen Linux-version tiedosto. Jos tekisit samanlaisen, niin käyttäisit tietysti oman järjestelmäsi asetustiedostoa pohjana.
        Silmäile Saltin ohjeet tilafunktioille pkg, file ja service. Nämä artikkelit ovat pitkiä, riittää kun luet vain johdannon ja silmäilet maintut komennot. Ei kannata yrittää opetella satoja itselle tarpeettomia parametreja ulkoa. (Less-vinkit alla)
            $ sudo salt-call --local sys.state_doc pkg # johdanto + silmäile pkg.installed, pkg.purged, pkgs
            $ sudo salt-call --local sys.state_doc file # johdanto + silmäile file.managed, file.absent, file.symlink
            $ sudo salt-call --local sys.state_doc service # johdanto + silmäile service.running, service.dead, enable



 #### a) Hello SLS! Tee Hei maailma -tila kirjoittamalla se tekstitiedostoon, esim /srv/salt/hello/init.sls.

Käytin tässä tehtävässä aiemmin tehtävässä h2 luomaani herra-orja arkkitehtuuria. Menin isäntäkoneellani luomaani palvelinten_hallinta_h2 -kansioon, jossa annoin `vagrant up` -komennon. Komennon seurauksena aiemmin luodut virtuaalikoneet käynnistettiin. Kirjauduin master-koneelle (t001) komennolla `vagrant ssh t001`.

![ssh_t001](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/ce600fb6-e6c7-4817-a943-9e026a020676)

Olin jo aiemmin luonut kansion /srv/salt/hello ja sinne init.sls -tiedoston. Poistin tiedoston aiemman sisällön ja kirjoitin sinne uutta sisältöä komennolla sudoedit init.sls.

![2](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/98e07298-d14f-484c-b6f3-0491d4e81f0c)


Tämän jälkeen ajoin komennon:

       sudo salt-call --local state.apply hello

Ja tulostui:


![3](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/1d2d3eaf-8573-4741-90d9-9bedb53bce09)


Komennto loi uuden tiedoston /tmp -kansioon. Tarkistin vielä, että kansio oli luotu:

![4](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/614a39b9-ca95-49dd-b9fc-3d5451013f06)


#### b) Top. Tee top.sls niin, että useita valitsemiasi tiloja ajetaan automaattisesti, esim komennolla "sudo salt '*' state.apply" tai "sudo salt-call --local state.apply".

Aloitin tehtävän luomalla uuden tiedoston kansioon /srv/salt komennolla `sudo mkdir uusihello`. 

![uusihello](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/b4cd92cc-dfd9-4ee2-8579-e48e36a1900b)

Tämän jälkeen tein uuden init.sls tiedoston kansioon uusihello komennolla sudoedit init.sls. Lisäsin tiedostoon koodia:

![sisalto](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/a3ec2463-3daf-46bd-a0c8-9e2a9131c1e7)

Tämän jälkeen loin /srv/salt kansioon top.sls -tiedoston, johon lisäsin koodia:

![topslssisalto](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/69e2694a-1c74-47b2-a65f-732770dcda29)

Tämän jälkeen annoin komennon `sudo salt '*' state.apply`

Alla kuvassa näkyy, kuinka orja-koneelle (t002) tehtiin kaksi uutta tiedostoa /tmp -kansioon. 

![top](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/b0061a33-b030-44b7-8281-12f1e86779e5)

#### c) Apache easy mode. Asenna Apache, korvaa sen testisivu ja varmista, että demoni käynnistyy.
        Ensin käsin, vasta sitten automaattisesti.
        Kirjoita tila sls-tiedostoon.
        pkg-file-service
        Tässä ei tarvita service:ssä watch, koska index.html ei ole asetustiedosto

Aloitin tehtävän asentamalla apachen komennolla `sudo apt-get install apache2`. Sitten siirryin kansioon /var/www/html.

Poistin kansiosta tiedoston index.html komennolla `sudo rm index.html`. Tein uuden tiedoston komennolla `sudo nano testi.html`. 

![kuva10](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/dc432753-4a19-4661-b335-555b6e80ac6f)

Käynnistetään vielä apache-demoni komennolla `sudo systemctl restart apache2`.

![kuva3](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/65cdb3a5-dd8a-48cd-bd07-6ac28009fe47)

Sitten siirryin kansioon /srv/salt/ ja tein uuden kansion apache2. Lisäsin apache2-kansioon tiedoston init.sls. 

![apache1](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/b17af65a-77cc-4ab2-b1b6-2b8615369abc)

Luon init.sls-tiedostoon neljä eri funktionta, joiden tarkoitus on ensin asentaa apache2. Sen jälkeen poistaa index.html-tiedosto kansiosta /var/www/html ja korvata index.html-tiedosto uudella tiedostolla newindex.html. Lopuksi vielä tarkistetaan, että apache2 on käynnissä. Suoritan tehtävän master-koneella ja ajan tilat orja-koneelle. 

Kirjoitan init.sls-tiedostoon seuraavat koodit:

![tiedosto](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/57996f21-4dd7-45ae-ba19-99b5f0c3f99d)



![tulos1](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/792f2dbe-3fc5-4d52-8b78-6fdbc9105b45)

![tulos2](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/1cadb6ff-398f-4d2a-a8ae-a57b9c095122)

![tulos3](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/84145233-ab48-4015-840f-2048754e10a9)

![tulos4](https://github.com/Pakknoo/Palvelinten_hallinta/assets/122889266/cbe00791-fd5d-446b-8fcb-a03ce364928e)




#### d) SSHouto. Lisää uusi portti, jossa SSHd kuuntelee.
        Jos käytät Vagrantia, muista jättää portti 22/tcp auki - se on oma yhteytesi koneeseen. SSHd:n asetustiedostoon voi tehdä yksinkertaisesti kaksi "Port" riviä, molemmat portit avataan.
Löydät oikean asetuksen katsomalla SSH:n asetustiedostoa
Nyt tarvitaan service-watch, jotta demoni käynnistetään uudelleen, jos asetustiedosto muuttuu masterilla

#### e) Vapaaehtoinen: Apache. Asenna Apache tarjoilemaan weppisivua. Weppisivun tulee näkyä palvelimen etusivulla (localhost). HTML:n tulee olla jonkun käyttäjän kotihakemistossa, ja olla muokattavissa normaalin käyttäjän oikeuksin, ilman sudoa.

#### f) Vapaaehtoinen: Caddy. Asenna Caddy tarjoilemaan weppisivua. Weppisivun tulee näkyä palvelimen etusivulla (localhost). HTML:n tulee olla jonkun käyttäjän kotihakemistossa, ja olla muokattavissa normaalin käyttäjän oikeuksin, ilman sudoa.

#### g) Vapaaehtoinen: Nginx. Asenna Nginx (lausutaan engine-X) tarjoilemaan weppisivua. Weppisivun tulee näkyä palvelimen etusivulla (localhost). HTML:n tulee olla jonkun käyttäjän kotihakemistossa, ja olla muokattavissa normaalin käyttäjän oikeuksin, ilman sudoa.
